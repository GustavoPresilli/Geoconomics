<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz de Bandeiras - Geoconomics</title>
    <link rel="stylesheet" href="assets/css/quiz_bandeira-capital.css">
    <link rel="shortcut icon" type="image/jpg" href="assets/img/logo_escura_prateada.png" />
</head>

<body>
    <button class="botaoSair" onclick="sair()">Sair</button>
    <p id="numQuestao"></p>
    <div class="pagina">
        <div class="tituloContainer">
            <h1>Quiz de Capital!</h1>
        </div>
        <div class="container">
            <div id="quiz_container" class="quiz-container">
                <h2 id="bandeira"></h2>
                <div class="opcoes">
                    <ul class="options" id="opcoesResposta"></ul>
                </div>
                <div class="botao">
                    <button id="next-btn" onclick="proximaQuestao()">Próxima Pergunta</button>
                </div>
            </div>
            <div class="resultado" id="resultado">
                <div class="container">
                    <div id="div_mensagem"></div>
                    <button onclick="reiniciar()">Reiniciar</button>
                </div>
            </div>
        </div>
    </div>

</body>

</html>
<script>
    var idUsuario = sessionStorage.ID_USUARIO;

    resultado.style.display = "none";
    const quizData = [
        {
            question: "Qual a capital da <span>Alemanha</span> ?",
            options: ["Berlim", "Moscou", "Pequim", "Tóquio"],
            correct: "Berlim"
        },
        {
            question: "Qual a capital da <span>Rússia</span> ?",
            options: ["Madrid", "Moscou", "Amsterdam", "Paris"],
            correct: "Moscou"
        },
        {
            question: "Qual a capital da <span>Noruega</span> ?",
            options: ["Estocolmo", "Helsing", "Oslo", "Lisboa"],
            correct: "Olso"
        },
        {
            question: "Qual a capital da <span>Irlanda</span> ?",
            options: ["Dublin", "Berna", "Ottawa", "Praga"],
            correct: "Dublin"
        },
        {
            question: "Qual a capital da <span>Egito</span> ?",
            options: ["Cidade do Cabo", "Nova Deli", "Cairo", "Luanda"],
            correct: "Cairo"
        },
        {
            question: "Qual a capital do <span>Peru</span> ?",
            options: ["La Paz", "Lima", "Santiago", "Montevidéu"],
            correct: "Lima"
        },
        {
            question: "Qual a capital da <span>Coreia do Sul</span> ?",
            options: ["Pyongyang", "Seoul", "Pequim", "Tóquio"],
            correct: "Seoul"
        },
        {
            question: "Qual a capital de <span>Cuba</span> ?",
            options: ["Quito", "Macau", "Havana", "Daca"],
            correct: "Havana"
        },
        {
            question: "Qual a capital da <span>Indonésia</span> ?",
            options: ["Jacarta", "Abu Dhabi", "Hanói", "Kingston"],
            correct: "Jacarta"
        },
        {
            question: "Qual a capital da <span>Palestina</span> ?",
            options: ["Bacu", "Banjui", "Ramallah", "Jerusalém"],
            correct: "Ramallah"
        },
        {
            question: "Qual a capital da <span>Hungria</span> ?",
            options: ["Bruxelas", "Ancara", "Atenas", "Budapeste"],
            correct: "Budapeste"
        },
        {
            question: "Qual a capital do <span>Irã</span> ?",
            options: ["Taipé", "Saná", "Teerã", "Riade"],
            correct: "Teerã"
        },
        {
            question: "Qual a capital do <span>Bahamas</span> ?",
            options: ["Nairóbi", "Nassau", "Guitega", "Inglaterra"],
            correct: "Nassau"
        },
        {
            question: "Qual a capital da <span>Costa Rica</span> ?",
            options: ["San José", "Quito", "Bogotá", "Astana"],
            correct: "San José"
        },
        {
            question: "Qual a capital da <span>Eitiópia</span> ?",
            options: ["Gaborone", "Beirute", "Adis-Abeba", "Abuja"],
            correct: "Adis-Abeba"
        }
    ];

    var questaoAtual = 0; //  Indice da pergunta atual
    var qtdAcertos = 0;  // Contador de acertos
    var qtdErros = 0;

    function carregarQuestao() {
        const currentQuestion = quizData[questaoAtual];
        bandeira.innerHTML = currentQuestion.question;
        opcoesResposta.innerHTML = '';

        for (var i = 0; i < currentQuestion.options.length; i++) {
            let opcaoAtual = currentQuestion.options[i]

            let opcaoResposta = document.createElement('li');

            opcaoResposta.innerText = opcaoAtual;

            // Criando a função da opção selecionada
            opcaoResposta.onclick = () => selectOption(opcaoResposta, opcaoAtual)

            // Usando apend child para definir qual é o pai 
            opcoesResposta.appendChild(opcaoResposta);
        }

    }


    carregarQuestao();
    // Carregar a primeira questão;

    numQuestao.innerHTML = `Questão ${questaoAtual + 1} de ${quizData.length}`

    // Função para selecionar a opção
    function selectOption(optionElement, option) {
        const selected = document.querySelector('.options li.selected');
        if (selected) {
            selected.classList.remove('selected');
        }
        optionElement.classList.add('selected');
        optionElement.id = "selecionado"

        const currentQuestion = quizData[questaoAtual];

    }

    // Passando para a próxima pergunta aumentando seu contador
    function proximaQuestao() {
        var questaoAtualMostrada = quizData[questaoAtual];
        var respostaSelecionada = selecionado.innerHTML;

        if (questaoAtualMostrada.correct === respostaSelecionada) {
            qtdAcertos++
        } else {
            qtdErros++
        }

        console.log("Acertos " + qtdAcertos);
        console.log("Erros " + qtdErros);
        questaoAtual++;

        if (questaoAtual < quizData.length) {
            carregarQuestao();
            numQuestao.innerHTML = `Questão ${questaoAtual + 1} de ${quizData.length}`
        } else {
            fetch(`/usuarios/cadastrarMetricasQuizPais`, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify({
                    idUsuarioServer: idUsuario,
                    qtdAcertosServer: qtdAcertos,
                    qtdErrosServer: qtdErros
                }),
            })
                .then(function (resposta) {
                    console.log("resposta: ", resposta);

                    if (resposta.ok) {

                        console.log("Cadastro realizado")
                    } else {
                        throw "Houve um erro ao tentar realizar o cadastro!";
                    }
                })
                .catch(function (resposta) {
                    console.log(`#ERRO: ${resposta}`);
                });
            mostrarResultados();
        }
    }


    function mostrarResultados() {
        quiz_container.style.display = "none";
        resultado.style.display = "block"
        div_mensagem.innerHTML = `Você acertou um total de ${qtdAcertos} perguntas`
    }

    function reiniciar() {
        window.location = "quiz_bandeiras.html";
    }

    function sair() {
        window.location = "curiosidade.html"
    }

</script>